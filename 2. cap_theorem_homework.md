### CAP теорема и базы данных: MongoDB, MSSQL, Cassandra

CAP теорема утверждает, что в распределённой системе можно обеспечить только два из трёх свойств: **C**onsistency (согласованность), **A**vailability (доступность), **P**artition tolerance (устойчивость к разделению). Рассмотрим, как это относится к указанным базам данных.

---

### 1. **MongoDB**
MongoDB — это гибкая система, которая может балансировать между C, A и P в зависимости от конфигурации и сценария работы:

#### Сценарии работы MongoDB:
| Сценарий                          | Основной фокус | Описание                                                                                                                                                                                                 |
|-----------------------------------|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Нет разделения сети**           | CA             | В нормальных условиях MongoDB обеспечивает **согласованность** (Consistency) и **доступность** (Availability).                                                                                          |
| **Разделение сети, большинство узлов подключено** | AP             | Если большинство узлов Replica Set остаются подключёнными, MongoDB сохраняет **доступность** (Availability) и **устойчивость к разделению** (Partition Tolerance), но жертвует **согласованностью**.    |
| **Разделение сети, большинство узлов не подключено** | CP             | Если большинство узлов отключено, MongoDB жертвует **доступностью** (Availability), чтобы сохранить **согласованность** (Consistency) и **устойчивость к разделению** (Partition Tolerance).            |

#### Особенности:
- **Согласованность (Consistency):**
  - MongoDB может быть как **строго согласованной** (strongly consistent), так и **согласованной в конечном счёте** (eventually consistent), в зависимости от настроек Write/Read Concern.
  - Например, при использовании `majority` для Write Concern и Read Concern, MongoDB обеспечивает строгую согласованность.
- **Доступность (Availability):**
  - MongoDB обеспечивает высокую доступность через Replica Sets. Если первичный узел становится недоступным, новый первичный узел выбирается автоматически.
- **Устойчивость к разделению (Partition Tolerance):**
  - MongoDB может работать в условиях разделения сети, пока большинство узлов остаются подключёнными. Если большинство узлов отключено, система становится недоступной для записи.

---

### 2. **MSSQL (Microsoft SQL Server)**
- **Тип системы:** CA (Consistency и Availability)
- **Обоснование:**
  - MSSQL традиционно является реляционной базой данных, которая обеспечивает **согласованность** (Consistency) и **доступность** (Availability) в рамках одной системы или кластера.
  - Однако MSSQL не является распределённой системой по умолчанию и не предназначена для работы в условиях разделения сети (Partition Tolerance). В распределённых конфигурациях (например, с использованием AlwaysOn Availability Groups) MSSQL может жертвовать доступностью или согласованностью в зависимости от настроек.

1. **Согласованность (Consistency):**
  - MSSQL гарантирует строгую согласованность данных благодаря поддержке ACID-транзакций (Atomicity, Consistency, Isolation, Durability).
  - Все операции записи и чтения выполняются в рамках транзакций, что обеспечивает целостность данных.

2. **Доступность (Availability):**
  - MSSQL обеспечивает высокую доступность за счёт таких функций, как **AlwaysOn Availability Groups** и **Failover Clustering**.
  - В случае сбоя первичного узла, вторичный узел автоматически становится доступным для обработки запросов.

3. **Устойчивость к разделению (Partition Tolerance):**
  - MSSQL не является распределённой системой по умолчанию и не предназначена для работы в условиях разделения сети (network partition).
  - В распределённых конфигурациях (например, с использованием AlwaysOn Availability Groups) MSSQL может жертвовать доступностью или согласованностью в зависимости от настроек. Например, если происходит разделение сети, система может стать недоступной для записи, чтобы избежать потери согласованности.

#### Пример:
- В нормальных условиях (без разделения сети) MSSQL обеспечивает строгую согласованность и высокую доступность.
- Однако в случае разделения сети, MSSQL может стать недоступной для записи, чтобы сохранить согласованность данных.

---

### 3. **Cassandra**
- **Тип системы:** AP (Availability и Partition Tolerance)
- **Обоснование:**
  Cassandra — это распределённая NoSQL база данных, которая prioritizes **доступность** (Availability) и **устойчивость к разделению** (Partition Tolerance):

1. **Доступность (Availability):**
  - Cassandra спроектирована для обеспечения высокой доступности. Даже в случае сбоя узла или разделения сети, Cassandra продолжает обрабатывать запросы на чтение и запись.
  - Это достигается за счёт децентрализованной архитектуры, где каждый узел равноправен, и данные реплицируются на несколько узлов.

2. **Устойчивость к разделению (Partition Tolerance):**
  - Cassandra отлично справляется с разделением сети (network partition). Она использует механизм **gossip protocol** для обнаружения состояния узлов и автоматического восстановления после сбоев.
  - Даже если часть узлов становится недоступной, Cassandra продолжает работать, используя оставшиеся узлы.

3. **Согласованность (Consistency):**
  - Cassandra жертвует строгой согласованностью ради доступности и устойчивости к разделению. Она использует модель **eventual consistency** (согласованность в конечном счёте), где данные со временем синхронизируются между узлами.
  - Однако Cassandra позволяет настраивать уровень согласованности для каждой операции (например, через параметры `QUORUM`, `ONE`, `ALL`). Это позволяет разработчикам выбирать баланс между согласованностью и производительностью.

#### Пример:
- Если происходит разделение сети, Cassandra продолжает принимать запросы на запись и чтение, даже если часть узлов недоступна. Однако данные могут быть несогласованными до тех пор, пока разделение не будет устранено и узлы не синхронизируются.

---

### Итог:
- **MongoDB:** Гибкая система, которая может быть CA, AP или CP в зависимости от сценария и конфигурации.
- **MSSQL:** CA (Consistency и Availability).
- **Cassandra:** AP (Availability и Partition Tolerance).